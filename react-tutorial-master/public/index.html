<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>React Tutorial</title>
  <!-- Not present in the tutorial. Just for basic styling. -->
  <link rel="stylesheet" href="css/base.css"/>
  <script src="https://unpkg.com/react@15.3.0/dist/react.js"></script>
  <script src="https://unpkg.com/react-dom@15.3.0/dist/react-dom.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  <script src="https://unpkg.com/jquery@3.1.0/dist/jquery.min.js"></script>
  <script src="https://unpkg.com/remarkable@1.6.2/dist/remarkable.min.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</head>
<body class="container">
<div id="app"></div>
<script type="text/babel">


  var UsersItem = React.createClass({
    done: function() {
      this.props.done(this.props.user);
    },

    render: function() {
      return (
        <div>
        <li onClick={this.done}>{this.props.user}</li>
          <input type="button" className="btn btn-danger" value="Unregister" onClick={this.done}/>
        </div>
      )
    }
  });

  var RegistrationForm = React.createClass({


    getInitialState: function () {
      return {
        email: '', name: '', company: '', isSelected: false, noOfUsers: 0,
        users: this.props.users
      };

    },


    storeName: function (event) {
      this.setState({name: event.target.value});
    },

    storeEmail: function (event) {
      this.setState({email: event.target.value});
    },

    storeCompany: function (event) {
      this.setState({company: event.target.value});
    },

    delete: function () {
      console.log("Button Clicked! Finallyyyyy");
    },

    done: function(user) {
      var users = this.props.users;
      users.splice(users.indexOf(user), 1);
      localStorage.setItem('users', JSON.stringify(users));
      this.setState({ users: users });
    },


    registerMessage: function () {
      console.log(this.state.name);
      console.log(this.state.email);
      console.log(this.state.company);

      this.state.self= this;
      //ADD

      var users = this.props.users;
      users.push(this.state.name);

      localStorage.setItem('users', JSON.stringify(users));
      this.setState({ users: users });


      this.setState({noOfUsers: this.state.noOfUsers + 1});

      console.log(this.state.noOfUsers);
      this.setState({isSelected: true});


      localStorage.setItem(this.state.email,this.state.name);

      for(var i=0, len=localStorage.length; i<len; i++) {
        var key = localStorage.key(i);
        var value = localStorage[key];
        console.log(key + "---->" + value);
      }
    },


    render: function () {
      var isSelected = false;

      return (
        <div >
          <div className="container container-table">
            <div className="row vertical-center-row">
              <div className="col-xs-9">
                <form className="form-group">

                  <div className="row">
                    <div className="col-xs-5  col-md-offset-2">
                      <h2> Women Who Code </h2>
                      <label >Name: </label>
                      <input className="form-control" id="name" type="text" placeholder="Enter Name!"
                             onBlur={this.storeName}/>
                    </div>
                  </div>

                  <div>
                    <div className="row">

                      <div className="col-xs-5  col-md-offset-2">
                        <label>EmailID: </label>
                        <input className="form-control" type="text" id="email" placeholder="Enter EmailID"
                               onBlur={this.storeEmail}/>
                      </div>
                    </div>
                  </div>

                  <div className="row">
                    <div className="col-xs-5  col-md-offset-2">
                      <label>Company/Institution: </label>
                      <input className="form-control" type="text" id="company" placeholder=" Enter Company/Institution"
                             onBlur={this.storeCompany}/>
                    </div>
                  </div>

                  <div className="row">
                    <div className="col-xs-3 col-md-offset-4">
                      <input className="btn btn-primary btn-space" onClick={this.registerMessage} type="button"
                             value="Register"/>
                    </div>
                    <div className="col-xs-6 col-md-offset-2">
                      {this.state.isSelected ? <h4>You have been successfully registered!</h4> : null}
                    </div>
                    <div className="col-xs-4 col-md-offset-9">
                      Users registered: {JSON.parse(localStorage.getItem("users")).length}
                    </div>
                  </div>

                  <div className="col-xs-3">
                    <ul className="UserList col-xs-5  col-md-offset-1">
                      {
                        this.state.users.map(function(user) {
                          return <UsersItem user={user} done={this.done} />
                        }.bind(this))
                      }
                    </ul>
                  </div>
                </form>

              </div>


            </div>
          </div>
        </div>
      )
    }

  });

  var users = JSON.parse(localStorage.getItem('users')) || [];

  ReactDOM.render(
    <RegistrationForm  users = {users}/>,
    document.getElementById('app')
  );

</script>
</body>
</html>

<style>
  .btn-space {
    margin-top: 20px;
  }

  .userDelete {
    display: flex;
    flex-direction: row-reverse;
  }

  .UserList {
    height: 200px;
    overflow-y: scroll;
  }

  html, body, .container-table {
    height: 100%;
    color: #f8f8f8;
  }

  .vertical-center {
    min-height: 100%;
    min-height: 100vh;

    display: flex;
    align-items: center;
  }
  .container-table {
    display: table;
  }

  .vertical-center-row {
    display: table-cell;
    vertical-align: middle;
  }

  .container {
    background-image: url("./images.jpeg");
  }
</style>
